**1. Основные данные и словари**
- Источник данных: `data.json` (сохраняются строки, статус, факт и время запуска).  
  Файл: `Qwen_python.py`
- Списки значений:
  - `POSITIONS`, `STATUSES`, `ARRIVAL_TIMES` — варианты для должности, статуса и времени прибытия.  
  Файл: `Qwen_python.py`
- Парсинг часов: функция `parse_hours()` переводит текст “1.5 часа” в число часов.  
  Файл: `Qwen_python.py`

**2. Интерфейс и стили**
- Основное окно: класс `App(tk.Tk)` создаёт окно, задаёт заголовок и разворачивает на весь экран.  
  Файл: `Qwen_python.py`
- Стили: `setup_style()` задаёт тему, цвета, стили кнопок и элементов.  
  Файл: `Qwen_python.py`
- Верхняя панель:
  - Кнопки `ЗАПУСК`, `ОЧИСТИТЬ ДАННЫЕ`
  - Поле поиска + кнопка `Далее` + `X` для очистки  
  Файл: `Qwen_python.py`

**3. Таблица (основная область)**
- `Treeview` с колонками: №, Должность, ФИО, Время прибытия, Факт, Опоздание, Статус.  
  Файл: `Qwen_python.py`
- Цвета строк:
  - Опоздание — красный фон  
  - Вовремя — зелёный  
  - Прочее (болен/командировка) — синий  
  Файл: `Qwen_python.py` (метод `apply_color()`)

**4. Добавление и редактирование строк**
- Добавление через окно “Добавить строку”:
  - Кнопки “Должность” и “ч+” открывают меню выбора.
  - Ввод ФИО — отдельное поле.
  - После подтверждения строка добавляется в таблицу.  
  Файл: `Qwen_python.py` (методы `open_add_dialog()`, `add_row_values()`)

- Редактирование в таблице:
  - По правому клику по ячейке “Должность/Время/Статус” открывается меню выбора.
  - По правому клику по ФИО — текстовое редактирование.  
  Файл: `Qwen_python.py` (методы `on_tree_right_click()`, `start_combo_edit()`, `start_text_edit()`)

**5. Выпадающие меню выбора**
- Все выпадающие списки реализованы вручную через `open_selector()`, чтобы они выглядели как кнопки:
  - Полный список, разделители между пунктами.
  - Подсветка при наведении.
  - Закрытие по `Esc` или при выборе.  
  Файл: `Qwen_python.py` (метод `open_selector()`)

**6. Поиск по таблице**
- Поиск по ФИО:
  - Вводим фамилию, Enter — первый результат.
  - Кнопка `Далее` — циклический переход по совпадениям.  
  Файл: `Qwen_python.py` (методы `search_from_entry()`, `search_next()`)

**7. Учёт времени прибытия**
- Кнопка `ЗАПУСК` фиксирует стартовое время.  
  Файл: `Qwen_python.py` (метод `start_timer()`)
- Двойной левый клик по строке фиксирует факт прибытия:
  - Ставит время “Факт”
  - Считает “Опоздание”  
  Файл: `Qwen_python.py` (методы `on_tree_double_click()`, `mark_arrival()`)

**8. Счётчики и проценты**
- Справа отображается:
  - Всего по списку
  - Присутствует / Болен / Командировка (с процентами)
  - Пришли (факт)
  - Процент прибытия  
  Файл: `Qwen_python.py` (метод `update_counters()`)

**9. Диаграмма**
- Столбчатая диаграмма:
  - Желтый — Всего
  - Красный — Опоздали
  - Синий — Болен + Командировка (одна колонка)
  - Зеленый — Вовремя  
  Файл: `Qwen_python.py` (метод `update_chart()`)

**10. Выгрузка в Excel**
- Выпадающий выбор “Выгрузка” открывает меню часов.
- Заголовок в файле: `YYYY-MM-DD.прибытие ч+X`.  
  Файл: `Qwen_python.py` (методы `open_export_menu()`, `export_excel()`)

**11. Сохранение/загрузка**
- При закрытии сохраняется `data.json`.
- При старте загружается.  
  Файл: `Qwen_python.py` (методы `save_data()`, `load_data()`)


   Схема архитектуры приложения в текстовом виде (по уровням и потокам данных).

**Архитектура (уровни)**  
1. **UI слой (Tkinter)**
- `App(tk.Tk)` — корневое окно
- Верхняя панель: запуск, очистка, поиск
- Центральная таблица (`Treeview`)
- Правая панель: действия, статистика, диаграмма, выгрузка

2. **Логика взаимодействия**
- Обработчики событий (клики, выборы, поиск, добавление)
- Меню выбора (`open_selector`)
- Редактирование ячеек и фиксация прихода

3. **Состояние**
- `self.rows` — модель данных таблицы
- `self.start_time` — время запуска
- `self.search_matches`, `self.search_index` — результаты поиска
- `self.edit_popup`, `self.edit_widget` — активное меню

4. **Персистентность**
- `save_data()` → `data.json`
- `load_data()` ← `data.json`

---

**Схема потоков данных**

```
Пользователь
   |
   v
[UI события] --> [Обработчики] --> [self.rows / self.start_time]
                       |
                       +--> [Treeview / Метки / Диаграмма]
                       |
                       +--> [save_data -> data.json]
```

---

**Ключевые компоненты и связи**

```
App (Tk)
├─ setup_style()
├─ create_widgets()
│   ├─ TopBar: Запуск / Очистка / Поиск
│   ├─ Treeview (таблица)
│   └─ RightPanel: Кнопки / Статистика / Диаграмма / Выгрузка
├─ Event Handlers
│   ├─ on_tree_right_click -> open_selector -> commit_combo
│   ├─ on_tree_double_click -> mark_arrival
│   ├─ search_from_entry / search_next
│   ├─ open_add_dialog -> add_row_values
│   └─ export_excel
├─ Calculations
│   ├─ update_counters
│   └─ update_chart
└─ Persistence
    ├─ save_data
    └─ load_data
